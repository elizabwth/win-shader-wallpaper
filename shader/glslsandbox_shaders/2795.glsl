{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n \n// R Tape loading error, 0:1\n \n// @P_Malin\n\n//#define LOADING_LOOP\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\n \nvec2 kResolution = vec2(256.0, 192.0);\n \n// Border phases\n\nconst float kPhaseBlank = 0.0;\nconst float kPhaseSilent = 1.0;\nconst float kPhaseHeader = 2.0;\nconst float kPhaseData = 3.0;\nconst float kPhaseRunning = 4.0;\n \n// Loading phases\n\nconst vec3 vTimeSilent1  = vec3(1.0,\t5.0,                       kPhaseSilent);\nconst vec3 vTimeHeader1  = vec3(2.0,  vTimeSilent1.y + 2.0,      kPhaseHeader);\nconst vec3 vTimeData1    = vec3(3.0,  vTimeHeader1.y + 0.125,    kPhaseData);\n \nconst vec3 vTimeBlank2   = vec3(4.0,  vTimeData1.y + 1.0,        kPhaseBlank);\nconst vec3 vTimeSilent2  = vec3(5.0,  vTimeBlank2.y + 2.0,       kPhaseSilent);\nconst vec3 vTimeHeader2  = vec3(6.0,  vTimeSilent2.y + 2.0,      kPhaseHeader);\nconst vec3 vTimeData2    = vec3(7.0,  vTimeHeader2.y + 1.0,      kPhaseData);\n \nconst vec3 vTimeSilent3  = vec3(8.0,  vTimeData2.y + 2.0,        kPhaseSilent);\nconst vec3 vTimeHeader3  = vec3(9.0,  vTimeSilent3.y + 2.0,      kPhaseHeader);\nconst vec3 vTimeData3    = vec3(10.0, vTimeHeader3.y + 0.125,    kPhaseData);\n \nconst vec3 vTimeSilent4  = vec3(11.0, vTimeData3.y + 2.0,        kPhaseSilent);\nconst vec3 vTimeHeader4  = vec3(12.0, vTimeSilent4.y + 2.0,      kPhaseHeader);\nconst vec3 vTimeData4    = vec3(13.0, vTimeHeader4.y + 38.0,     kPhaseData);\n \nconst vec3 vTimeRunning  = vec3(14.0, vTimeData4.y + 10.0,       kPhaseRunning);\n \nconst vec3 vTimeTotal    = vec3(15.0, vTimeRunning.y,            kPhaseBlank);\n       \nvec4 GetPhase(float fTime)\n{             \n        vec3 vResult = vTimeRunning;\n                \n        vResult = mix( vResult, vTimeData4, step(fTime, vTimeData4.y ) );\n        vResult = mix( vResult, vTimeHeader4, step(fTime, vTimeHeader4.y ) );\n        vResult = mix( vResult, vTimeSilent4, step(fTime, vTimeSilent4.y ) );\n \n        vResult = mix( vResult, vTimeData3, step(fTime, vTimeData3.y ) );\n        vResult = mix( vResult, vTimeHeader3, step(fTime, vTimeHeader3.y ) );\n        vResult = mix( vResult, vTimeSilent3, step(fTime, vTimeSilent3.y ) );\n               \n        vResult = mix( vResult, vTimeData2, step(fTime, vTimeData2.y ) );\n        vResult = mix( vResult, vTimeHeader2, step(fTime, vTimeHeader2.y ) );\n        vResult = mix( vResult, vTimeSilent2, step(fTime, vTimeSilent2.y ) );\n        vResult = mix( vResult, vTimeBlank2, step(fTime, vTimeBlank2.y ) );\n \n        vResult = mix( vResult, vTimeData1, step(fTime, vTimeData1.y ) );\n        vResult = mix( vResult, vTimeHeader1, step(fTime, vTimeHeader1.y ) );\n        vResult = mix( vResult, vTimeSilent1, step(fTime, vTimeSilent1.y ) );\n               \n        return vec4(vResult.z, vResult.x, fTime - vResult.y, vResult.y);\n}\n \nfloat GetRasterPosition()\n{\n        return (gl_FragCoord.x + gl_FragCoord.y * resolution.x) / (resolution.x * resolution.y);\n}\n \nfloat IsBorder(vec2 vScreenUV)\n{\n        if(vScreenUV.x < 0.0)\n                        return 1.0;\n        if(vScreenUV.x >= 1.0)\n                        return 1.0;\n        if(vScreenUV.y < 0.0)\n                        return 1.0;\n        if(vScreenUV.y >= 1.0)\n                        return 1.0;\n       \n        return 0.0;\n}\n \n \nvec3 GetBorderColour(float fPhase)\n{\n\tfloat raster = GetRasterPosition();\n\t\n\tvec3 vCol = vec3(0.0);\n\t\n\tif(fPhase == kPhaseBlank)\n\t{                       \n\t\tvCol = vec3(1.0);           \n\t}\n\telse  \n\tif(fPhase == kPhaseSilent)\n\t{\n\t\tfloat fBlend = step(fract(time * 0.5), 0.5);\n\t\tvCol = mix( vec3(0.0, 1.0, 1.0), vec3(1.0, 0.0, 0.0), fBlend);           \n\t}\n\telse\n\tif(fPhase == kPhaseHeader)\n\t{\n\t\tfloat fBarSize = 12.0;\n\t\tfloat fScrollSpeed = 10.0;\n\t\tfloat fBlend = step(fract(raster * fBarSize + time * fScrollSpeed), 0.5);\n\t\tvCol = mix( vec3(0.0, 1.0, 1.0), vec3(1.0, 0.0, 0.0), fBlend);           \n\t}\n\telse\n\tif(fPhase == kPhaseData)\n\t{\n\t\tfloat fBarSize = 25.0;\n\t\tfloat fScrollSpeed = 1.0;\n\t\tfloat fBlend = step(fract(raster * fBarSize + time * fScrollSpeed + sin(time * 20.0 + raster * 16.0)), 0.5);\n\t\tvCol = mix(vec3(1.0, 1.0, 0.0), vec3(0.0, 0.0, 1.0), fBlend);                     \n\t}\n\t\n\treturn vCol;\n}\n \n \nfloat GetLoadingScreenIntensity( vec2 vPos )\n{\n\tvec2 vUV = vPos / kResolution;\n\tfloat r = 0.25;\n\tvec2 vDist = (vUV - 0.5) / r;\n\tfloat len = length(vDist);\n\tvec3 vNormal = vec3(vDist.x, sqrt(1.0 - len * len), vDist.y);\n\tvec3 vLight = normalize( vec3(1.0, 1.0, -1.0) );\n\tif(len < 1.0)\n\t{\n\t\treturn max(0.0, dot(vNormal, vLight));\n\t}\n\t\n\treturn 0.7 - vUV.y * 0.6;\n}\n \nfloat CrossHatch(float fIntensity, vec2 vPos)\n{\n\tvec2 vGridPos = mod(vPos, 4.0);\n\t\n\tfloat fThreshold = fract(vGridPos.x * 0.25 + vGridPos.y * 0.5) * 0.75 + fract(vGridPos.y * 0.25 + vGridPos.x * 0.5) * 0.25;\n\t\n\treturn step(fIntensity, fThreshold);\n}\n \nfloat GetLoadingScreenPixel( vec2 vPos )\n{\n        return CrossHatch(GetLoadingScreenIntensity(vPos), vPos);\n}\n \nvec2 GetScreenPixelCoord( vec2 vScreenUV )\n{\n        vec2 vPixelPos = floor(vScreenUV * kResolution);\n        vPixelPos.y = 192.0 - vPixelPos.y;\n       \n        return vPixelPos;\n}\n \nfloat PixelAddress( vec2 vPixelPos )\n{               \n        float fBand = floor(vPixelPos.y / 64.0);\n       \n        float fBandPos = mod(vPixelPos.y, 64.0);\n \n        float fCharRow = mod(fBandPos, 8.0);\n        float fCharPos = floor(fBandPos / 8.0);\n \n        float fBytePos = floor(vPixelPos.x / 8.0);\n \n        float fLineTime = fBand * 64.0 + fCharRow * 8.0 + fCharPos;\n        return (fBytePos + fLineTime * (256.0 / 8.0));\n}\n \nfloat AttributeAddress(vec2 vCharPos)\n{             \n\tfloat kAttributeStart = 256.0 * 192.0 / 8.0;\n\treturn kAttributeStart + vCharPos.x + vCharPos.y * 32.0;\n}\n \nfloat GetCharByte(const in float value)\n{\n        float result = 0.0;\n        result = mix(result, 0.0, step(value, 919.0) );\n        result = mix(result, 32.0, step(value, 918.5) );\n        result = mix(result, 28.0, step(value, 914.5) );\n        result = mix(result, 0.0, step(value, 913.5) );\n        result = mix(result, 56.0, step(value, 894.5) );\n        result = mix(result, 68.0, step(value, 893.5) );\n        result = mix(result, 56.0, step(value, 890.5) );\n        result = mix(result, 0.0, step(value, 889.5) );\n        result = mix(result, 84.0, step(value, 878.5) );\n        result = mix(result, 104.0, step(value, 874.5) );\n        result = mix(result, 0.0, step(value, 873.5) );\n        result = mix(result, 56.0, step(value, 851.5) );\n        result = mix(result, 4.0, step(value, 830.5) );\n        result = mix(result, 60.0, step(value, 829.5) );\n        result = mix(result, 68.0, step(value, 828.5) );\n        result = mix(result, 60.0, step(value, 826.5) );\n        result = mix(result, 0.0, step(value, 825.5) );\n        result = mix(result, 60.0, step(value, 782.5) );\n        result = mix(result, 68.0, step(value, 781.5) );\n        result = mix(result, 60.0, step(value, 780.5) );\n        result = mix(result, 4.0, step(value, 779.5) );\n        result = mix(result, 56.0, step(value, 778.5) );\n        result = mix(result, 0.0, step(value, 777.5) );\n        result = mix(result, 60.0, step(value, 670.5) );\n        result = mix(result, 66.0, step(value, 669.5) );\n        result = mix(result, 2.0, step(value, 668.5) );\n        result = mix(result, 60.0, step(value, 667.5) );\n        result = mix(result, 64.0, step(value, 666.5) );\n        result = mix(result, 60.0, step(value, 665.5) );\n        result = mix(result, 0.0, step(value, 664.5) );\n        result = mix(result, 64.0, step(value, 646.5) );\n        result = mix(result, 124.0, step(value, 644.5) );\n        result = mix(result, 66.0, step(value, 643.5) );\n        result = mix(result, 124.0, step(value, 641.5) );\n        result = mix(result, 0.0, step(value, 640.5) );\n        result = mix(result, 60.0, step(value, 638.5) );\n        result = mix(result, 66.0, step(value, 637.5) );\n        result = mix(result, 60.0, step(value, 633.5) );\n        result = mix(result, 0.0, step(value, 632.5) );\n        result = mix(result, 66.0, step(value, 630.5) );\n        result = mix(result, 70.0, step(value, 629.5) );\n        result = mix(result, 74.0, step(value, 628.5) );\n        result = mix(result, 82.0, step(value, 627.5) );\n        result = mix(result, 98.0, step(value, 626.5) );\n        result = mix(result, 66.0, step(value, 625.5) );\n        result = mix(result, 0.0, step(value, 624.5) );\n        result = mix(result, 126.0, step(value, 614.5) );\n        result = mix(result, 64.0, step(value, 613.5) );\n        result = mix(result, 0.0, step(value, 608.5) );\n        result = mix(result, 62.0, step(value, 590.5) );\n        result = mix(result, 8.0, step(value, 589.5) );\n        result = mix(result, 62.0, step(value, 585.5) );\n        result = mix(result, 0.0, step(value, 584.5) );\n        result = mix(result, 60.0, step(value, 574.5) );\n        result = mix(result, 66.0, step(value, 573.5) );\n        result = mix(result, 78.0, step(value, 572.5) );\n        result = mix(result, 64.0, step(value, 571.5) );\n        result = mix(result, 66.0, step(value, 570.5) );\n        result = mix(result, 60.0, step(value, 569.5) );\n        result = mix(result, 0.0, step(value, 568.5) );\n        result = mix(result, 120.0, step(value, 550.5) );\n        result = mix(result, 68.0, step(value, 549.5) );\n        result = mix(result, 66.0, step(value, 548.5) );\n        result = mix(result, 68.0, step(value, 546.5) );\n        result = mix(result, 120.0, step(value, 545.5) );\n        result = mix(result, 0.0, step(value, 544.5) );\n        result = mix(result, 66.0, step(value, 526.5) );\n        result = mix(result, 126.0, step(value, 524.5) );\n        result = mix(result, 66.0, step(value, 523.5) );\n        result = mix(result, 60.0, step(value, 521.5) );\n        result = mix(result, 0.0, step(value, 520.5) );\n        result = mix(result, 16.0, step(value, 470.5) );\n        result = mix(result, 0.0, step(value, 469.5) );\n        result = mix(result, 16.0, step(value, 467.5) );\n        result = mix(result, 0.0, step(value, 466.5) );\n        return result;   \n}\n \nfloat GetBit( float fByte, float fBit )\n{\n        return mod(floor(fByte / pow(2.0, 7.0-fBit)), 2.0) ;\n}\n \nfloat GetCharPixel( float fChar, vec2 vPos )\n{\n        float fCharAddress = fChar * 8.0 + vPos.y;\n       \n        float fCharBin = GetCharByte(fCharAddress);\n       \n        return GetBit(fCharBin, vPos.x);\n}\n \nfloat GetProgramStringChar(float fPos)\n{\n        float fChar = 32.0;    \n        fChar = mix(fChar, 76.0, step(fPos, 12.5) );\n        fChar = mix(fChar, 83.0, step(fPos, 11.5) );\n        fChar = mix(fChar, 76.0, step(fPos, 10.5) );\n        fChar = mix(fChar, 71.0, step(fPos, 9.5) );\n        fChar = mix(fChar, 32.0, step(fPos, 8.5) );\n        fChar = mix(fChar, 58.0, step(fPos, 7.5) );\n        fChar = mix(fChar, 109.0, step(fPos, 6.5) );\n        fChar = mix(fChar, 97.0, step(fPos, 5.5) );\n        fChar = mix(fChar, 114.0, step(fPos, 4.5) );\n        fChar = mix(fChar, 103.0, step(fPos, 3.5) );\n        fChar = mix(fChar, 111.0, step(fPos, 2.5) );\n        fChar = mix(fChar, 114.0, step(fPos, 1.5) );\n        fChar = mix(fChar, 80.0, step(fPos, 0.5) );\n        return fChar;\n}\n \nfloat GetLoadingStringChar(float fPos)\n{\n        float fChar = 32.0;    \n        fChar = mix(fChar, 76.0, step(fPos, 11.0) );\n        fChar = mix(fChar, 83.0, step(fPos, 10.5) );\n        fChar = mix(fChar, 76.0, step(fPos, 9.5) );\n        fChar = mix(fChar, 71.0, step(fPos, 8.5) );\n        fChar = mix(fChar, 32.0, step(fPos, 7.5) );\n        fChar = mix(fChar, 71.0, step(fPos, 6.5) );\n        fChar = mix(fChar, 78.0, step(fPos, 5.5) );\n        fChar = mix(fChar, 73.0, step(fPos, 4.5) );\n        fChar = mix(fChar, 68.0, step(fPos, 3.5) );\n        fChar = mix(fChar, 65.0, step(fPos, 2.5) );\n        fChar = mix(fChar, 79.0, step(fPos, 1.5) );\n        fChar = mix(fChar, 76.0, step(fPos, 0.5) );\n        return fChar;\n}\n \nfloat GetProgramText(vec2 vPixelPos)\n{     \n        vec2 vCharCoord = floor(vPixelPos / 8.0);\n       \n        float fChar = GetProgramStringChar(vCharCoord.x);\n       \n        if(vCharCoord.y != 0.0)\n                fChar = 32.0;\n       \n        return GetCharPixel(fChar, mod(vPixelPos, 8.0));\n}\n \nfloat GetLoadingText(vec2 vPixelPos)\n{     \n        vec2 vCharCoord = floor(vPixelPos / 8.0);\n       \n        float fChar = GetLoadingStringChar(vCharCoord.x);\n       \n        float inString = 1.0;\n        if(vCharCoord.x < 0.0)\n                fChar = 32.0;\n       \n        if(vCharCoord.y != 0.0)\n                fChar = 32.0;\n       \n        return GetCharPixel(fChar, mod(vPixelPos, 8.0));\n}\n \nfloat GetScreenPixel(vec2 vScreenPixel)\n{\n\t// plasma thing\n\tfloat f = sin(vScreenPixel.x *0.0432 + sin(vScreenPixel.y * 0.0423)+ time * 3.0);\n\tf = f + sin(vScreenPixel.y * 0.0454513 + sin(vScreenPixel.x * 0.07213) + time * 5.0);\n\tf = f + sin(vScreenPixel.x * 0.043353 + sin(vScreenPixel.y * 0.043413) + time * 8.0);\n\tf = f + sin(vScreenPixel.y * 0.0443513 + sin(vScreenPixel.x * 0.036313) + time * 10.0);\n\tf = f * 0.125 + 0.5;\n\t\n\treturn CrossHatch(f, vScreenPixel);\n}\n\nvoid main( void )\n{           \n\tfloat fSequenceTime = time;\n\t\n\t#ifdef LOADING_LOOP\n\tfSequenceTime = mod(fSequenceTime, vTimeTotal.y);\n\t#endif\n\t\n\tvec3 col = vec3(1.0);\n\t\n\tvec4 vPhase = GetPhase(fSequenceTime);\n\t\n\tvec2 vUV = ( gl_FragCoord.xy / resolution.xy );\n\tvec2 vScreenUV = (vUV - 0.1) / 0.8;\n\tif(IsBorder(vScreenUV) > 0.0)\n\t{\n\t\tcol = GetBorderColour(vPhase.x);\n\t}\n\telse\n\t{\n\t\tvec2 vScreenCoord = GetScreenPixelCoord(vScreenUV);\n\t\tvec2 vAttribCoord = floor(vScreenCoord / 8.0);\n\n\t\tfloat fPixelValue = 0.0;\n\t\tvec3 vInk = vec3(0.0);\n\t\tvec3 vPaper = vec3(1.0);\n\t\t\n\t\tif(vPhase.x != kPhaseRunning)\n\t\t{\n\t\t\t// loading\n\t\t\tfloat fLoadScreenTime = fSequenceTime - vTimeHeader4.y;\n\t\t\t\t\t\t\t\t\t\t       \n\t\t\tfloat fAddressLoaded = fLoadScreenTime * 192.0;\n\t\t\tif(PixelAddress(vScreenCoord) > fAddressLoaded)\n\t\t\t{\n\t\t\t\tif(vPhase.y < 4.0)\n\t\t\t\t{\n\t\t\t\t\tcol = vec3(1.0);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\tif(vPhase.y < 8.0)\n\t\t\t\t{\n\t\t\t\t\tvec2 vTextPos = vec2(0.0, 8.0);\n\t\t\t\t\tfPixelValue = GetProgramText(vScreenCoord - vTextPos);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvec2 vTextPos = vec2(10.0 * 8.0, 19.0 * 8.0);\n\t\t\t\t\tfPixelValue = GetLoadingText(vScreenCoord - vTextPos);\n\t\t\t\t}\t\t\t\t\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// loading screen\n\t\t\t\tfPixelValue = GetLoadingScreenPixel(vScreenCoord);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t}\n\t\t\n\t\t\tif(AttributeAddress(vAttribCoord) < fAddressLoaded)\n\t\t\t{\n\t\t\t\tvInk = vec3(0.0, 0.0, 1.0);\n\t\t\t\tvPaper = vec3(1.0, 1.0, 0.0);\n\t\t\t}\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// running\n\t\t\tfPixelValue = GetScreenPixel(vScreenCoord);\n\t\t\t\n\t\t\tvec2 vTextPos = vec2(-8.0 * 8.0, 8.0);\n\t\t\tfloat fAttribValue = GetLoadingText(vAttribCoord - vTextPos );\n\t\t\tvPaper = mix(vec3(0.0, 1.0, 1.0), vec3(1.0, 0.0, 0.0), fAttribValue);\n\t\t\tvInk = vec3(0.0, 0.0, 1.0);\n\t\t}     \n\t\n\t\t//fPixelValue = GetScreenPixel(vScreenCoord); // force final effect\t\t\t\n\t\t//fPixelValue = GetLoadingScreenPixel( vScreenCoord); // force loading screen\n\t\n\t\tcol = mix(vPaper, vInk, fPixelValue);\n\t\t\n\t}\n\n\tfloat kBrightness = 0.8;\n\tgl_FragColor = vec4( col * kBrightness, 1.0 );  \n}", "user": "1bb7b9a", "parent": null, "id": "2795.1"}