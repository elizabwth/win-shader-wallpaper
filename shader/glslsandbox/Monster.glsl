{"code": "#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform float time;\nuniform vec2 mouse;\nuniform vec2 resolution;\nuniform sampler2D iChannel0, iChannel1, iChannel2;\n\n#define   iResolution vec3(resolution, 1.0)\n#define   iGlobalTime time\n\n// uniform vec3       iResolution;\n// uniform float      iGlobalTime;\n// uniform float      iChannelTime[4];\n // uniform vec3       iChannelResolution[4];\n// uniform vec4       iMouse;\n// uniform vec4       iDate;\n\n#define R(p,a) p=p*cos(a)+vec2(-p.y,p.x)*sin(a);\n\nfloat sph(vec3 p, float r){\n\treturn sqrt(dot(p,p))-r;\n}\n\nfloat box(vec3 p, vec3 r){\n\tvec3 di = abs(p)-r;\n\treturn min( max(di.x,max(di.y,di.z)), length(max(di,0.0)) );\n}\n\nvec3 dd(vec3 p, vec2 mo, vec4 ro){\n\tvec3 sp = p;\n\tsp.x=abs(sp.x);\n\tvec3 tp = p+vec3(0.0,0.0,0.345);\n\tR(tp.yz,-0.4);\n\tR(tp.xz,-p.x);\n\ttp.x = mod(tp.x,0.03)-0.015;\n\ttp.y=tp.y*(3.17+mo.x)-0.05*mo.y;\n\tfloat m = sph(tp,0.008);\n\tfloat b = p.y>-0.4?sph(p*vec3(1.0,0.5,1.0)-vec3(0.0,-0.2,0.0),0.4):sqrt(dot(p+vec3(0.0,0.4,0.0),p+vec3(0.0,0.4,0.0)))-0.4;\n\tfloat r = sph(sp*vec3(p.x<0.0?ro.x:ro.y,1.0,1.0)-vec3(0.0,p.x<0.0?ro.z:ro.w,-0.3),0.1);\n\tfloat e = max(sph(sp-vec3(0.05,0.1,-0.3),0.04),-r);\n\n\tsp.y-=0.13;\n\tR(sp.xy,-0.6);\n\tR(sp.xz,0.9);\n\tR(sp.yz,sp.x*13.3+11.3);\n\tfloat ht = 0.07 - sp.x*0.13;\n\tfloat h = box(sp,vec3(0.5,ht,ht));\n\treturn vec3(b,h,-min(m,e));\n}\n\nfloat bg(vec3 p){\n\tR(p.xz,1.3*cos(max(iGlobalTime-2.66,0.0)));\n\tvec3 sp = p;\n\tsp.xz+=1.0;\n\tsp.xz = mod(sp.xz,1.6)-0.8;\n\tsp.y+=1.3+0.1*cos(iGlobalTime+p.x);\n\tsp.y*=1.0-dot(p.xz,p.xz)*0.02;\n\tfloat f = sph(sp,1.0);\n\tsp = p;\n\tsp.y-=8.7;\n\tR(sp.yz,iGlobalTime*0.02);\n\tsp = mod(sp,0.34)-0.17;\n\tfloat c = sph(sp,0.10+0.01*cos(iGlobalTime*7.0+p.x+p.y+p.z));\n\treturn min(-sph(p,7.0),max(f,-c));\n}\n\nvec2 scene(vec3 p){\n\tfloat t = iGlobalTime-2.66;\n\tp.z-=0.13*(-cos(max(t,0.0)*0.3));\n\tR(p.xz,0.17*sin(max(t,0.0)));\n\t\n\tfloat t1 = mod(max(t,0.0),15.0);\n\tfloat t2 = clamp(mod(max(t,0.0),45.0)-36.0,0.0,1.41)*6.66;\n\tfloat t3 = clamp(mod(max(t,0.0),30.0)-21.0,0.0,3.14);\n\n\tvec2 m;\n\tm.x = -(2.1+clamp(t1-4.0,0.0,0.9)-2.0*clamp(t1-14.55,0.0,0.9))-0.02*cos(t*3.3);\n\tm.y = (1.0-cos(abs(p.x-0.3*sin(clamp(t1*1.3,0.0,6.28)))))*28.0*cos(5.0);\n\tvec4 r;\n\tr.x = 0.6-0.6*sin(clamp(t1*1.3,0.0,6.28));\n\tr.y = 0.6-0.6*sin(clamp(t1*1.3+3.14,3.14,9.42));\n\tr.z = 0.175+0.040*clamp(t,0.0,0.25)+0.02*(sin(t3)+abs(sin(t2)));\n\tr.w = 0.175+0.040*clamp(t,0.0,0.25)+0.02*abs(sin(t2));\n\tvec3 d = dd(p,m,r);\n\tfloat b = bg(p);\n\tfloat c = d.x<0.0?2.0:1.0;\n\td.y = min(d.x,d.y);\n\td.x=max(max(d.y,-d.x),d.z);\n\treturn vec2(min(d.x,b),d.x<b?c:0.0);\n}\n\nvoid main(void)\n{\n\tvec2 pos = (gl_FragCoord.xy-0.5*iResolution.xy) / min(iResolution.x,iResolution.y);\n\tvec3 o = vec3(0.0,0.0,-min(iResolution.x,iResolution.y)/max(iResolution.x,iResolution.y));\n\tvec3 d = vec3(pos,0.0)-o;\n\tvec3 p = o;\n\tvec2 l;\n\tfloat e = 0.0001;\n\tvec3 c = vec3(0.0);\n\tfor(int i = 0; i<128; i++){\n\t\tl=scene(p);\n\t\tif(abs(l.x)<e){\n\t\t\tc.x = 1.0+float(i)/128.0;\n\t\t\tbreak;\n\t\t}\n\t\tp += l.x*d;\n\t}\n\tc=(l.y==0.0?vec3(0.3,0.13*abs(0.2+0.5*cos((p.y+iGlobalTime)*3.0+0.5*cos(p.x*12.0))),0.1)*c.xxx:c);\n\tc=(l.y==2.0?vec3(1.0,+0.6+0.2*abs(cos(p.y*66.6-iGlobalTime*6.66+cos(p.x*33.0))),0.0):c);\n\tc*=(l.y!=2.0?scene(p+0.1*vec3(2.0,2.0,-3.3)).x:1.0);\n\tgl_FragColor = vec4(c,1.0);\n}", "user": "61e70d1", "parent": null, "id": "17166.1"}